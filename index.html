<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>~*~ AI Identificador de Frutas ~*~</title>
    
    <style>
        body {
            /* Fundo cl√°ssico de 'c√©u estrelado' ou cor s√≥lida forte */
            background-color: #000033;
            background-image: url('https://www.transparenttextures.com/patterns/stardust.png'); /* Textura leve */
            color: #FFFF00; /* Texto amarelo chamativo */
            font-family: "Comic Sans MS", "Verdana", sans-serif;
            text-align: center;
            margin: 0;
            padding: 20px;
        }

        /* Simulando layout de tabela centralizada */
        .main-table {
            width: 600px;
            background-color: #C0C0C0; /* O cinza cl√°ssico do Windows */
            border: 2px solid #FFFFFF;
            border-right-color: #404040;
            border-bottom-color: #404040;
            padding: 10px;
            margin: 0 auto;
        }

        h1 {
            font-family: "Times New Roman", serif;
            color: #FF0000;
            text-shadow: 2px 2px #000000;
            margin: 5px;
        }

        .marquee-container {
            background-color: #000000;
            color: #00FF00; /* Verde matrix */
            border: 1px solid #808080;
            font-family: "Courier New", monospace;
            font-weight: bold;
            margin-bottom: 15px;
        }

        /* Estilo de bot√£o "Windows 95/98" */
        button, .file-input-wrapper {
            background-color: #d4d0c8;
            color: #000000;
            font-family: "Verdana", sans-serif;
            font-size: 14px;
            padding: 5px 15px;
            border-top: 2px solid #ffffff;
            border-left: 2px solid #ffffff;
            border-right: 2px solid #404040;
            border-bottom: 2px solid #404040;
            cursor: pointer;
            margin: 10px 0;
            font-weight: bold;
        }

        button:active {
            border-top: 2px solid #404040;
            border-left: 2px solid #404040;
            border-right: 2px solid #ffffff;
            border-bottom: 2px solid #ffffff;
        }

        /* Input de arquivo cru e feio (como era antigamente) */
        input[type="file"] {
            font-family: "Courier New", monospace;
            font-size: 12px;
            color: black;
        }

        /* Container da imagem com borda grossa */
        .preview-box {
            background-color: #000000;
            border: 3px inset #808080;
            padding: 5px;
            display: none; /* Escondido no inicio */
            margin: 10px auto;
            width: 320px;
        }

        img#preview {
            max-width: 300px;
            border: 1px solid #FFFFFF;
        }

        /* √Årea de resultado */
        #resultado {
            font-family: "Courier New", monospace;
            font-size: 16px;
            font-weight: bold;
            color: #000080; /* Azul marinho */
            background-color: #FFFFFF;
            border: 1px solid #000000;
            padding: 10px;
            margin-top: 15px;
            display: none;
        }

        hr {
            border: 0;
            border-top: 1px solid #808080;
            border-bottom: 1px solid #FFFFFF;
            margin: 20px 0;
        }

        .footer {
            font-size: 10px;
            color: #FFFFFF;
            margin-top: 20px;
        }

        a { color: #00FFFF; }
        a:visited { color: #FF00FF; }
    </style>
</head>
<body>

    <br>
    
    <table class="main-table" cellspacing="0" cellpadding="5">
        <tr>
            <td align="center">
                
                <div class="marquee-container">
                    <marquee scrollamount="5" scrolldelay="100">
                        *** BEM VINDO AO SISTEMA DE I.A. *** VERS√ÉO 1.0 ***
                    </marquee>
                </div>

                <h1><u>AI Identificador de Frutas</u> üçé</h1>
                <p><font color="black" size="2">Envie uma foto.</font></p>
                
                <hr>

                <table width="100%" bgcolor="#E0E0E0" border="1" bordercolor="white">
                    <tr>
                        <td align="center" padding="10">
                            <p><font color="black"><b>Passo 1:</b> Selecione o arquivo no seu Computador</font></p>
                            
                            <input type="file" id="arquivoInput" accept="image/*" onchange="mostrarPreview()">
                            
                            <br><br>
                            
                            <div class="preview-box" id="previewContainer">
                                <img id="preview" src="" alt="Aguardando imagem...">
                            </div>
                        </td>
                    </tr>
                </table>

                <br>

                <button onclick="enviarImagem()" id="btnIdentificar">
                    [ CLIQUE AQUI PARA IDENTIFICAR ]
                </button>

                <div id="resultado"></div>
                <hr>
                            </td>
        </tr>
    </table>

    <script>
        function mostrarPreview() {
            const arquivo = document.getElementById('arquivoInput').files[0];
            const preview = document.getElementById('preview');
            const previewContainer = document.getElementById('previewContainer');
            const resultadoDiv = document.getElementById('resultado');

            // Limpa resultado anterior
            resultadoDiv.style.display = 'none';
            resultadoDiv.innerText = '';

            if (arquivo) {
                preview.src = URL.createObjectURL(arquivo);
                previewContainer.style.display = 'block';
            }
        }

        async function enviarImagem() {
            const arquivoInput = document.getElementById('arquivoInput');
            const resultadoDiv = document.getElementById('resultado');
            const btn = document.getElementById('btnIdentificar');
            
            if (arquivoInput.files.length === 0) {
                alert("ERRO: Nenhuma imagem selecionada.\nPor favor, selecione um arquivo.");
                return;
            }

            const formData = new FormData();
            formData.append('file', arquivoInput.files[0]);

            // UI Retro de carregamento
            resultadoDiv.style.display = 'block';
            resultadoDiv.innerHTML = "<blink>CONECTANDO AO SERVIDOR...</blink>";
            resultadoDiv.style.color = "blue";
            btn.disabled = true;
            btn.innerText = "Processando...";

            try {
                // Fetch mantido igual para garantir funcionamento
                const response = await fetch('/predict', { 
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) throw new Error("Erro 500: Falha no Server");

                const data = await response.json();
                
                const frutaIdentificada = data.fruta || data.prediction || data.class || JSON.stringify(data);
                
                resultadoDiv.style.color = "green";
                resultadoDiv.innerHTML = "RESULTADO:<br>------------------<br><b>" + frutaIdentificada.toUpperCase() + "</b>";
                
                // Um alert cl√°ssico para confirmar
                alert("Processo conclu√≠do com sucesso!");
                
            } catch (error) {
                console.error(error);
                resultadoDiv.style.color = "red";
                resultadoDiv.innerText = "FATAL ERROR: " + error.message;
                alert("Ocorreu um erro no script.");
            } finally {
                btn.disabled = false;
                btn.innerText = "[ CLIQUE AQUI PARA IDENTIFICAR ]";
            }
        }
    </script>
</body>
</html>